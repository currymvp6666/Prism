<UserControl x:Class="Prism.Views.MemoView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:Prism.ViewModel"
             mc:Ignorable="d"
             d:DesignHeight="450"
             d:DesignWidth="850">

    <!-- ⚠️ DataContext 不动 -->
    <UserControl.DataContext>
        <vm:DashboardViewModel/>
    </UserControl.DataContext>

    <!-- ================= 资源 ================= -->
    <UserControl.Resources>

        <!-- 主色 -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#4CAF50"/>
        <SolidColorBrush x:Key="BgColor" Color="#F5F7FA"/>
        <SolidColorBrush x:Key="CardBgColor" Color="White"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="TextMain" Color="#333333"/>
        <SolidColorBrush x:Key="TextSub" Color="#777777"/>

        <!-- 顶部菜单按钮 -->
        <Style x:Key="MenuButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Todo 卡片 -->
        <Style x:Key="TodoCardStyle" TargetType="Border">
            <Setter Property="Width" Value="180"/>
            <Setter Property="Height" Value="140"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Background" Value="{StaticResource CardBgColor}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="12"
                                      ShadowDepth="2"
                                      Opacity="0.15"/>
                </Setter.Value>
            </Setter>
        </Style>

    </UserControl.Resources>

    <!-- ================= 主体 ================= -->
    <Grid Background="{StaticResource BgColor}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ================= 顶部工具栏 ================= -->
        <Border Grid.Row="0"
                Background="White"
                Height="60"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Button Grid.Column="0"
                        Content="查看"
                        Style="{StaticResource MenuButtonStyle}"
                        Foreground="{StaticResource TextMain}"
                        FontSize="14"
                        Margin="20,0,0,0"/>
                

                <Border Grid.Column="1"
        Background="#EEEEEE"
        CornerRadius="18"
        Height="36"
        Width="150"
        VerticalAlignment="Center"
        HorizontalAlignment="Right">

                    <Grid Height="36" VerticalAlignment="Top">
                        <!-- 输入框 -->
                        <TextBox Text="{Binding SearchTextMemo, UpdateSourceTrigger=PropertyChanged}"
                 Background="Transparent"
                 BorderThickness="0"
                 FontSize="13"
                 Padding="10,0,10,0"
                 VerticalContentAlignment="Center"/>

                        <!-- Placeholder -->
                        <TextBlock Text="搜索"
                   Foreground="#999"
                   Margin="12,0,0,0"
                   VerticalAlignment="Center"
                   IsHitTestVisible="False">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SearchTextMemo}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SearchTextMemo}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Border>

                <!-- 筛选 + 添加 -->
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Margin="0,0,20,0">

                  

                    <Button Width="120"
                            Height="36"
                            Margin="20,0,0,0"
                            Background="{StaticResource PrimaryColor}"
                            Foreground="White"
                            BorderThickness="0"
                            Cursor="Hand"
                            Command="{Binding ShowAddMemoDialogCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="+" FontSize="18" Margin="0,0,5,0"/>
                            <TextBlock Text="添加备忘录"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <Button Grid.Column="3"
                        Content="⋮"
                        Style="{StaticResource MenuButtonStyle}"
                        FontSize="20"
                        Foreground="{StaticResource TextSub}"
                        Width="40"
                        Height="40"
                        Margin="0,0,20,0"/>
            </Grid>
        </Border>

        <!-- ================= 卡片区域 ================= -->
        <ScrollViewer Grid.Row="1"
                      Margin="20"
                      VerticalScrollBarVisibility="Auto">

            <ItemsControl ItemsSource="{Binding Memos}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource TodoCardStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="28"/>
                                </Grid.RowDefinitions>

                                <Button Grid.Row="0"
                                        Content="⋮"
                                        HorizontalAlignment="Right"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Foreground="{StaticResource TextSub}"
                                        Command="{Binding DataContext.EditMemoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Width="30"/>

                                <StackPanel Grid.Row="1"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Stretch"
                                        Margin="10,0">

                                    <!-- 编号（弱化显示） -->
                                    <TextBlock Text="{Binding Id, StringFormat=#{0}}"
                                        FontSize="11"
                                        Foreground="#999999"
                                        Margin="0,0,0,4"/>

                                    <!-- 标题（主信息） -->
                                    <TextBlock Text="{Binding Title}"
                                        FontSize="14"
                                        FontWeight="SemiBold"
                                        Foreground="{StaticResource TextMain}"
                                        TextWrapping="Wrap"
                                        MaxWidth="160"
                                        Margin="0,0,0,6"/>

                                    <!-- 描述（次信息） -->
                                    <TextBlock Text="{Binding Content}"
                                        FontSize="12"
                                        Foreground="{StaticResource TextSub}"
                                        TextWrapping="Wrap"
                                        MaxWidth="160"
                                        LineHeight="16"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

        </ScrollViewer>
    </Grid>
</UserControl>
